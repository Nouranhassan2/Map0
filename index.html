<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>خريطة متاجر الحي</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDSQwC16g8ZKoyVC2EpixPr0e-7IcPII14&libraries=places&callback=initMap" async defer></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      direction: rtl;
    }
    #map {
      height: 100vh;
      width: 100%;
      transition: width 0.3s;
    }
    #sidebar {
      height: 100%;
      width: 30%;
      position: fixed;
      left: 0;
      top: 0;
      background-color: #f8f9fa;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
      padding: 20px;
      display: none;
      z-index: 1000;
      transition: transform 0.3s ease;
      overflow-y: auto;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 999;
      gap: 10px;
    }
    #sidebar h3 {
      margin-top: 0;
      color: #ea9c57;
    }
    #close-sidebar {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: #d9534f;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 5px;
      font-weight: bold;
    }
    #search-input {
      width: 250px;
      height: 40px;
      padding: 8px 12px;
      font-size: 14px;
      background-color: white;
      border: 2px solid #ea9c57;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #search-button {
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      background-color: #ea9c57;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    #search-button:hover {
      background-color: #d97706;
    }
    .whatsapp-share-btn {
      display: inline-block;
      background-color: #25D366;
      color: white;
      padding: 8px 16px;
      font-size: 14px;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    .whatsapp-share-btn:hover {
      background-color: #20b858;
    }
    
    .whatsapp-sidebar-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #25D366;
      color: white;
      padding: 12px 20px;
      font-size: 16px;
      text-decoration: none;
      border-radius: 8px;
      margin-top: 20px;
      transition: background-color 0.3s ease;
      font-weight: bold;
    }
    
    .whatsapp-sidebar-btn:hover {
      background-color: #20b858;
      color: white;
      text-decoration: none;
    }
    
    .whatsapp-icon {
      width: 24px;
      height: 24px;
      margin-right: 10px;
      fill: currentColor;
    }
    
    .info-header {
      font-size: 24px;
      margin-bottom: 15px;
      color: #2c3e50;
    }
    .info-content {
      font-size: 16px;
      padding: 10px 0;
      line-height: 1.6;
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .status-active {
      background-color: #22c55e;
      color: white;
    }
    
    .status-launching {
      background-color: #ea9c57;
      color: white;
    }
    
    .status-planned {
      background-color: #a78bfa;
      color: white;
    }
    
    .store-stats {
      background-color: #f0f8ff;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border-right: 4px solid #ea9c57;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    @media (max-width: 768px) {
      #sidebar {
        width: 100%;
      }
      #map {
        height: 60vh;
      }
      .controls {
        flex-direction: column;
        position: relative;
        top: 10px;
        right: 10px;
        background: rgba(255,255,255,0.9);
        padding: 10px;
        border-radius: 8px;
        width: fit-content;
      }
      #search-input {
        width: 200px;
        margin-bottom: 10px;
      }
    }
  </style>
</head>
<body>

  <!-- أدوات التحكم -->
  <!-- <div class="controls">
    <!-- <input id="search-input" type="text" placeholder="ابحث عن حي..." />
    <button id="search-button">بحث</button>
     <a id="share-btn-sidebar" href="#" target="_blank" class="whatsapp-share-btn">شارك عبر واتساب</a> -->
  <!-- </div> --> 

  <!-- الخريطة -->
  <div id="map"></div>

  <!-- الشريط الجانبي -->
  <div id="sidebar">
    <button id="close-sidebar">✕</button>
    <h3 id="location-name" class="info-header"></h3>
    <div id="status-badge" class="status-badge"></div>
    
    <div class="info-content">
      <div class="store-stats" id="stats-container">
        <!-- الإحصائيات ستظهر هنا -->
      </div>
      
      <p><strong>الموقع:</strong> <span id="location-details"></span></p>
      <a id="location-link" href="#" target="_blank" style="color: #ea9c57; font-weight: bold;">زيارة المنصة</a>
      <br><br>
      <img id="location-image" src="" alt="صورة الموقع" style="width:100%; height:auto; border-radius: 8px;">
      
      <!-- زر مشاركة واتساب -->
      <a id="whatsapp-share-sidebar" href="#" target="_blank" class="whatsapp-sidebar-btn">
        <svg class="whatsapp-icon" viewBox="0 0 24 24">
          <path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.582 2.128 2.182-.573c.978.58 1.911.928 3.145.929 3.178 0 5.767-2.587 5.768-5.766.001-3.187-2.575-5.77-5.764-5.771zm3.392 8.244c-.144.405-.837.774-1.17.824-.299.045-.677.063-1.092-.069-.252-.08-.575-.187-.988-.365-1.739-.751-2.874-2.502-2.961-2.617-.087-.116-.708-.94-.708-1.793s.448-1.273.607-1.446c.159-.173.346-.217.462-.217l.332.006c.106.005.249-.04.39.298.144.347.491 1.2.534 1.287.043.087.072.188.014.304-.058.116-.087.188-.173.289l-.26.304c-.087.086-.177.18-.076.354.101.174.449.741.964 1.201.662.591 1.221.774 1.394.86s.274.072.376-.043c.101-.116.433-.506.549-.68.116-.173.231-.145.39-.087s1.011.477 1.184.564.289.13.332.202c.045.072.045.419-.1.824z"/>
        </svg>
        مشاركة عبر الواتساب
      </a>
    </div>
  </div>

  <script>
    let map, highlightCircle;
    let markers = [];

    const locations = [
      // المنصات المطلقة (Active)
      { lat: 21.2854, lng: 39.2376, name: 'حي السنابل - جدة', link: 'https://jed1.matajeralhai.com/', status: 'active', storesCount: 150, offersCount: 45, image: 'https://jed1.matajeralhai.com/Images/Photos/63f719b49e404dbb9a7217ded02fef23.webp' },
      { lat: 21.2854, lng: 39.2376, name: 'حي الأجاويد - جدة', link: 'https://jed1.matajeralhai.com/', status: 'active', storesCount: 120, offersCount: 32, image: '' },
      { lat: 21.5433, lng: 39.1728, name: 'حي الرياض - جدة', link: 'https://jed6.matajeralhai.com/', status: 'active', storesCount: 98, offersCount: 28, image: '' },
      { lat: 21.5454, lng: 39.2049, name: 'حي الحمدانية - جدة', link: 'https://jed4.matajeralhai.com/', status: 'active', storesCount: 85, offersCount: 25, image: '' },
      { lat: 21.5027, lng: 39.2433, name: 'حي الفضيلة - جدة', link: 'https://jed5.matajeralhai.com/', status: 'active', storesCount: 110, offersCount: 30, image: '' },
      { lat: 21.5752, lng: 39.2125, name: 'حي السامر - جدة', link: 'https://jed2.matajeralhai.com/', status: 'active', storesCount: 95, offersCount: 22, image: '' },
      { lat: 21.6319, lng: 39.1225, name: 'حي النعيم - جدة', link: 'https://jed10.matajeralhai.com/', status: 'active', storesCount: 140, offersCount: 38, image: '' },
      { lat: 21.6159, lng: 39.1277, name: 'حي المحمدية - جدة', link: 'https://jed10.matajeralhai.com/', status: 'active', storesCount: 125, offersCount: 35, image: '' },
      { lat: 25.7605, lng: 45.3943, name: 'حي تمير - الرياض', link: 'https://rydh5.matajeralhai.com/', status: 'active', storesCount: 80, offersCount: 20, image: '' },
      { lat: 24.4620, lng: 39.6120, name: 'حي الدفاع - المدينة المنورة', link: 'https://md1.matajeralhai.com/', status: 'active', storesCount: 75, offersCount: 18, image: '' },
      { lat: 24.4740, lng: 39.6100, name: 'حي الخالدية - المدينة المنورة', link: 'https://md1.matajeralhai.com/', status: 'active', storesCount: 90, offersCount: 24, image: '' },
      { lat: 16.8894, lng: 42.5824, name: 'أحياء جيزان', link: 'https://jzn1.matajeralhai.com', status: 'active', storesCount: 105, offersCount: 28, image: '' },
      { lat: 18.2175, lng: 42.5058, name: 'حي المفتاحة - أبها', link: 'https://ba1.matajeralhai.com/mainPage', status: 'active', storesCount: 70, offersCount: 15, image: '' },
      { lat: 25.5902, lng: 45.3012, name: 'أحياء المجمعة', link: 'https://rydh7.matajeralhai.com/mainPage', status: 'active', storesCount: 85, offersCount: 22, image: '' },
      { lat: 25.5951, lng: 45.6338, name: 'أحياء حوطة سدير', link: 'https://rydh6.matajeralhai.com/mainPage', status: 'active', storesCount: 65, offersCount: 16, image: '' },
      { lat: 27.0100, lng: 44.3900, name: 'أحياء حائل', link: 'https://ha1.matajeralhai.com/mainPage', status: 'active', storesCount: 95, offersCount: 25, image: '' },
      { lat: 20.0129, lng: 41.4677, name: 'أحياء الباحة', link: 'https://ba2.matajeralhai.com/mainPage', status: 'active', storesCount: 60, offersCount: 14, image: '' },
      { lat: 25.2951, lng: 46.4067, name: 'أحياء شقراء', link: 'https://rydh8.matajeralhai.com/mainPage', status: 'active', storesCount: 55, offersCount: 12, image: '' },
      { lat: 26.8906, lng: 44.6497, name: 'أحياء الزلفي', link: 'https://rydh9.matajeralhai.com/mainPage', status: 'active', storesCount: 50, offersCount: 10, image: '' },

      // المنصات قيد الإطلاق (Launching)
      { lat: 21.6011, lng: 39.1802, name: 'النسيم والسليمانية - جدة', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 75, image: '' },
      { lat: 24.7330, lng: 46.6970, name: 'أحياء بلجرشي', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 60, image: '' },
      { lat: 21.3891, lng: 39.8579, name: 'حي الزايدي - مكة', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 55, image: '' },
      { lat: 21.4243, lng: 39.8259, name: 'حي التنعيم - مكة', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 65, image: '' },
      { lat: 26.0395, lng: 43.9747, name: 'أحياء بريدة', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 70, image: '' },
      { lat: 26.0995, lng: 43.9741, name: 'أحياء عنيزة', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 50, image: '' },
      { lat: 25.9292, lng: 43.3046, name: 'أحياء الرس', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 45, image: '' },
      { lat: 25.8872, lng: 44.0256, name: 'أحياء المذنب', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 40, image: '' },
      { lat: 26.1496, lng: 43.6397, name: 'أحياء البكيرية', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 35, image: '' },
      { lat: 25.9178, lng: 43.7036, name: 'أحياء البدائع', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 30, image: '' },
      { lat: 25.8614, lng: 43.5711, name: 'أحياء عقلة الصقور', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 25, image: '' },
      { lat: 25.9758, lng: 43.5711, name: 'أحياء عيون الجواء', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 20, image: '' },
      { lat: 18.2962, lng: 42.5058, name: 'أحياء خميس مشيط', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 55, image: '' },
      { lat: 24.4871, lng: 39.5679, name: 'أحياء الحناكية', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 40, image: '' },
      { lat: 20.1938, lng: 41.4710, name: 'أحياء المندق', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 35, image: '' },
      { lat: 17.1865, lng: 42.5923, name: 'أحياء صبيا', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 45, image: '' },
      { lat: 17.1282, lng: 42.4447, name: 'أحياء بيش', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 30, image: '' },
      { lat: 20.2196, lng: 40.3367, name: 'أحياء الليث', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 50, image: '' },
      { lat: 20.6098, lng: 41.7462, name: 'أحياء القنفذة', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 40, image: '' },
      { lat: 25.0243, lng: 45.3072, name: 'أحياء جلاجل', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 60, image: '' },
      { lat: 25.2745, lng: 45.3825, name: 'أحياء الغاط', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 45, image: '' },
      { lat: 25.7277, lng: 45.1645, name: 'أحياء رياض الخبراء', link: '', status: 'launching', storesCount: 0, offersCount: 0, launchProgress: 35, image: '' },

      // المنصات المخطط لها (Planned)
      { lat: 21.5165, lng: 39.1790, name: 'حي المروة - جدة', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q2 2025', image: '' },
      { lat: 21.5300, lng: 39.2140, name: 'حي الصفا - جدة', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q2 2025', image: '' },
      { lat: 21.5892, lng: 39.1979, name: 'حي الجامعة - جدة', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q3 2025', image: '' },
      { lat: 21.4900, lng: 39.2400, name: 'حي العزيزية - جدة', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q3 2025', image: '' },
      { lat: 21.6100, lng: 39.1240, name: 'حي البوادي - جدة', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q4 2025', image: '' },
      { lat: 21.4000, lng: 39.8200, name: 'حي الشرائع - مكة', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q2 2025', image: '' },
      { lat: 21.4100, lng: 39.8100, name: 'حي العوالي - مكة', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q3 2025', image: '' },
      { lat: 21.4200, lng: 39.8300, name: 'حي النوارية - مكة', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q3 2025', image: '' },
      { lat: 21.3800, lng: 39.8400, name: 'حي بطحاء قريش - مكة', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q4 2025', image: '' },
      { lat: 22.8020, lng: 39.0434, name: 'أحياء رابغ', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q2 2025', image: '' },
      { lat: 22.2544, lng: 39.7181, name: 'أحياء خليص', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q3 2025', image: '' },
      { lat: 27.5114, lng: 41.0371, name: 'أحياء الحائط - حائل', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q1 2026', image: '' },
      { lat: 24.5000, lng: 39.6000, name: 'أحياء أخرى بالمدينة', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q4 2025', image: '' },
      { lat: 24.6500, lng: 46.7000, name: 'أحياء جديدة بالرياض', link: '', status: 'planned', storesCount: 0, offersCount: 0, plannedLaunch: 'Q1 2026', image: '' }
    ];

    function getStatusInfo(status, location) {
      switch(status) {
        case 'active':
          return {
            text: 'متاح الآن',
            class: 'status-active',
            description: 'يمكنك زيارة المنصة والاستفادة من العروض المتاحة'
          };
        case 'launching':
          return {
            text: 'جاري الإطلاق',
            class: 'status-launching',
            description: `التقدم: ${location.launchProgress || 0}% - سيكون متاحاً قريباً`
          };
        case 'planned':
          return {
            text: 'قريباً',
            class: 'status-planned',
            description: `مخطط للإطلاق: ${location.plannedLaunch || 'قريباً'}`
          };
        default:
          return {
            text: 'غير محدد',
            class: 'status-planned',
            description: 'الحالة غير محددة'
          };
      }
    }

    function initMap() {
      console.log('بدء تهيئة الخريطة...');
      
      // تحديد أيقونات الـ pins الجديدة بالتصميم المطور
      const pinIcons = {
        active: {
          url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
            <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="greenGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#34d399;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#22c55e;stop-opacity:1" />
                </linearGradient>
              </defs>
              <ellipse cx="50" cy="115" rx="15" ry="5" fill="#00000020"/>
              <path d="M50 10 C30 10, 15 25, 15 45 C15 65, 50 100, 50 100 S85 65, 85 45 C85 25, 70 10, 50 10 Z" 
                    fill="url(#greenGradient)" stroke="#16a34a" stroke-width="2"/>
              <circle cx="50" cy="45" r="25" fill="#f8fbfd" stroke="#22c55e" stroke-width="2"/>
              <g transform="translate(50, 45)">
                <rect x="-12" y="-8" width="24" height="16" fill="#22c55e" rx="2"/>
                <rect x="-3" y="-2" width="6" height="8" fill="#f8fbfd" rx="1"/>
                <rect x="-10" y="-6" width="4" height="4" fill="#f8fbfd" rx="0.5"/>
                <rect x="6" y="-6" width="4" height="4" fill="#f8fbfd" rx="0.5"/>
                <polygon points="-14,-8 0,-15 14,-8" fill="#16a34a"/>
                <circle cx="2" cy="2" r="0.8" fill="#22c55e"/>
              </g>
              <circle cx="50" cy="45" r="3" fill="#7ebfe9"/>
              <ellipse cx="42" cy="35" rx="8" ry="12" fill="#ffffff40"/>
            </svg>
          `),
          scaledSize: new google.maps.Size(50, 60),
          anchor: new google.maps.Point(25, 60)
        },
        launching: {
          url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
            <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="orangeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#f4a568;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#ea9c57;stop-opacity:1" />
                </linearGradient>
              </defs>
              <ellipse cx="50" cy="115" rx="15" ry="5" fill="#00000020"/>
              <path d="M50 10 C30 10, 15 25, 15 45 C15 65, 50 100, 50 100 S85 65, 85 45 C85 25, 70 10, 50 10 Z" 
                    fill="url(#orangeGradient)" stroke="#d18a46" stroke-width="2"/>
              <circle cx="50" cy="45" r="25" fill="#f8fbfd" stroke="#ea9c57" stroke-width="2"/>
              <g transform="translate(50, 45)">
                <rect x="-12" y="-8" width="24" height="16" fill="#ea9c57" rx="2"/>
                <rect x="-3" y="-2" width="6" height="8" fill="#f8fbfd" rx="1"/>
                <rect x="-10" y="-6" width="4" height="4" fill="#f8fbfd" rx="0.5"/>
                <rect x="6" y="-6" width="4" height="4" fill="#f8fbfd" rx="0.5"/>
                <polygon points="-14,-8 0,-15 14,-8" fill="#d18a46"/>
                <circle cx="2" cy="2" r="0.8" fill="#ea9c57"/>
              </g>
              <circle cx="50" cy="45" r="3" fill="#7ebfe9"/>
              <ellipse cx="42" cy="35" rx="8" ry="12" fill="#ffffff40"/>
            </svg>
          `),
          scaledSize: new google.maps.Size(50, 60),
          anchor: new google.maps.Point(25, 60)
        },
planned: {
          url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
            <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="redGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#fca5a5;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#f87171;stop-opacity:1" />
                </linearGradient>
              </defs>
              <ellipse cx="50" cy="115" rx="15" ry="5" fill="#00000020"/>
              <path d="M50 10 C30 10, 15 25, 15 45 C15 65, 50 100, 50 100 S85 65, 85 45 C85 25, 70 10, 50 10 Z" 
                    fill="url(#redGradient)" stroke="#ef4444" stroke-width="2"/>
              <circle cx="50" cy="45" r="25" fill="#f8fbfd" stroke="#f87171" stroke-width="2"/>
              <g transform="translate(50, 45)">
                <rect x="-12" y="-8" width="24" height="16" fill="#f87171" rx="2"/>
                <rect x="-3" y="-2" width="6" height="8" fill="#f8fbfd" rx="1"/>
                <rect x="-10" y="-6" width="4" height="4" fill="#f8fbfd" rx="0.5"/>
                <rect x="6" y="-6" width="4" height="4" fill="#f8fbfd" rx="0.5"/>
                <polygon points="-14,-8 0,-15 14,-8" fill="#ef4444"/>
                <circle cx="2" cy="2" r="0.8" fill="#f87171"/>
              </g>
              <circle cx="50" cy="45" r="3" fill="#dc2626"/>
              <ellipse cx="42" cy="35" rx="8" ry="12" fill="#ffffff40"/>
            </svg>
          `),
          scaledSize: new google.maps.Size(50, 60),
          anchor: new google.maps.Point(25, 60)
        }
      };
const mapCenter = { lat: 25.7, lng: 45.3 }; // ✅ يضع الخريطة على تمير وسدير
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 9,
        center: mapCenter,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        restriction: {
          latLngBounds: {
      north: 33.5,
      south: 16.5,
      west: 34.5,
      east: 52.0
    },
          strictBounds: true
        },
        styles: [
          {
            featureType: "poi",
            elementType: "labels",
            stylers: [{ visibility: "off" }]
          }
        ]
      });

      console.log('عدد المواقع لإضافتها:', locations.length);

      // إنشاء العلامات
      locations.forEach((location, index) => {
        const status = location.status || 'planned';
        const icon = pinIcons[status] || pinIcons.planned;
        
        console.log(`إنشاء علامة ${index + 1}: ${location.name} - الحالة: ${status}`);
        
        const marker = new google.maps.Marker({
          position: { lat: location.lat, lng: location.lng },
          map: map,
          icon: icon,
          title: location.name,
          clickable: true,
          optimized: false
        });

        // إضافة event listener للنقر
        marker.addListener('click', function() {
          console.log('تم النقر على:', location.name);
          try {
            showSidebar(location);
            console.log('تم فتح الـ sidebar بنجاح');
          } catch (error) {
            console.error('خطأ في فتح الـ sidebar:', error);
          }
        });

        markers.push(marker);
      });

      console.log('تم إنشاء', markers.length, 'علامة على الخريطة');
    }

    function performSearch() {
      const inputText = document.getElementById("search-input").value.toLowerCase().trim();
      if (inputText === "") {
        alert("يرجى إدخال اسم الحي للبحث.");
        return;
      }

      let foundLocations = [];
      locations.forEach(location => {
        if (location.name.toLowerCase().includes(inputText)) {
          foundLocations.push(location);
        }
      });

      // مسح العلامات الموجودة
      markers.forEach(marker => marker.setMap(null));
      markers = [];

      // مسح الدائرة الموجودة
      if (highlightCircle) {
        highlightCircle.setMap(null);
      }

      if (foundLocations.length === 0) {
        alert("لا توجد نتائج مطابقة. يرجى المحاولة بكلمات أخرى.");
      } else {
        const bounds = new google.maps.LatLngBounds();
        foundLocations.forEach(location => {
          const status = location.status || 'planned';
          const icon = pinIcons[status] || pinIcons.planned;
          
          const marker = new google.maps.Marker({
            position: { lat: location.lat, lng: location.lng },
            map: map,
            icon: icon,
            title: location.name
          });

          marker.addListener('click', () => {
            showSidebar(location);
          });

          markers.push(marker);
          bounds.extend(marker.position);
        });

        map.fitBounds(bounds);
        
        if (foundLocations.length === 1) {
          map.setZoom(14);

          // رسم دائرة حول الموقع المكتشف
          highlightCircle = new google.maps.Circle({
            strokeColor: "#ea9c57",
            strokeOpacity: 0.8,
            strokeWeight: 3,
            fillColor: "#ea9c57",
            fillOpacity: 0.1,
            map: map,
            center: { lat: foundLocations[0].lat, lng: foundLocations[0].lng },
            radius: 1000
          });

          // إظهار الشريط الجانبي للموقع المكتشف
          showSidebar(foundLocations[0]);
        }
      }
    }

    function showSidebar(location) {
      console.log('بدء فتح sidebar للموقع:', location.name);
      
      try {
        const statusInfo = getStatusInfo(location.status, location);
        
        // تعديل اسم الموقع
        const locationNameElement = document.getElementById('location-name');
        if (locationNameElement) {
          locationNameElement.textContent = location.name;
          console.log('تم تعديل اسم الموقع');
        }
        
        const locationDetailsElement = document.getElementById('location-details');
        if (locationDetailsElement) {
          locationDetailsElement.textContent = location.name;
        }
        
        // إظهار شارة الحالة
        const statusBadge = document.getElementById('status-badge');
        if (statusBadge) {
          statusBadge.textContent = statusInfo.text;
          statusBadge.className = 'status-badge ' + statusInfo.class;
          console.log('تم تعديل شارة الحالة');
        }
        
        // إظهار الإحصائيات
        const statsContainer = document.getElementById('stats-container');
        if (statsContainer) {
          if (location.status === 'active') {
            statsContainer.innerHTML = `
              <h4 style="margin: 0 0 10px 0; color: #2c3e50;">📊 إحصائيات المنصة</h4>
              <div class="stat-item">
                <span>عدد المتاجر:</span>
                <strong>${location.storesCount || 0} متجر</strong>
              </div>
              <div class="stat-item">
                <span>عدد العروض:</span>
                <strong>${location.offersCount || 0} عرض</strong>
              </div>
              <div class="stat-item">
                <span>الحالة:</span>
                <strong style="color: #22c55e;">متاحة الآن ✓</strong>
              </div>
            `;
          } else if (location.status === 'launching') {
            statsContainer.innerHTML = `
              <h4 style="margin: 0 0 10px 0; color: #2c3e50;">🚧 حالة الإطلاق</h4>
              <div class="stat-item">
                <span>التقدم:</span>
                <strong>${location.launchProgress || 0}%</strong>
              </div>
              <div class="stat-item">
                <span>الحالة:</span>
                <strong style="color: #ea9c57;">جاري العمل عليها</strong>
              </div>
              <p style="margin: 10px 0; color: #666; font-size: 14px;">
                نعمل بجد لإطلاق هذه المنصة قريباً. سنبلغك فور توفرها!
              </p>
            `;
          } else {
            statsContainer.innerHTML = `
              <h4 style="margin: 0 0 10px 0; color: #2c3e50;">📅 مخطط للمستقبل</h4>
              <div class="stat-item">
                <span>الإطلاق المتوقع:</span>
                <strong>${location.plannedLaunch || 'قريباً'}</strong>
              </div>
              <div class="stat-item">
                <span>الحالة:</span>
                <strong style="color: #a78bfa;">قيد التخطيط</strong>
              </div>
              <p style="margin: 10px 0; color: #666; font-size: 14px;">
                هذه المنصة مخططة للإطلاق قريباً. اشترك للحصول على إشعار عند الإطلاق!
              </p>
            `;
          }
          console.log('تم تعديل الإحصائيات');
        }
        
        // إظهار رابط الزيارة أو إخفاؤه
        const locationLink = document.getElementById('location-link');
        if (locationLink) {
          if (location.link && location.status === 'active') {
            locationLink.href = location.link;
            locationLink.style.display = 'inline-block';
            locationLink.textContent = 'زيارة المنصة الآن';
          } else {
            locationLink.style.display = 'none';
          }
        }
        
        // إظهار الصورة
        const locationImage = document.getElementById('location-image');
        if (locationImage) {
          if (location.image) {
            locationImage.src = location.image;
            locationImage.style.display = 'block';
          } else {
            locationImage.style.display = 'none';
          }
        }

        // إنشاء رسالة مشاركة واتساب
        let shareMessage = `🏪 اكتشف موقع: ${location.name}\n`;
        shareMessage += `📍 الحالة: ${statusInfo.text}\n`;
        
        if (location.status === 'active' && location.link) {
          shareMessage += `🔗 زيارة المنصة: ${location.link}\n`;
          shareMessage += `🏬 المتاجر: ${location.storesCount || 0}\n`;
          shareMessage += `🎯 العروض: ${location.offersCount || 0}\n`;
        } else if (location.status === 'launching') {
          shareMessage += `⏳ التقدم: ${location.launchProgress || 0}%\n`;
        } else {
          shareMessage += `📅 الإطلاق المتوقع: ${location.plannedLaunch || 'قريباً'}\n`;
        }
        
        shareMessage += `\n📱 تابع جميع منصات متاجر الحي على خريطتنا التفاعلية!`;
        
        const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(shareMessage)}`;
        
        // تحديث زر الواتساب
        const whatsappButton = document.getElementById('whatsapp-share-sidebar');
        if (whatsappButton) {
          whatsappButton.href = whatsappUrl;
        }

        // إظهار الشريط الجانبي
        const sidebar = document.getElementById('sidebar');
        const mapElement = document.getElementById('map');
        
        if (sidebar && mapElement) {
          sidebar.style.display = 'block';
          mapElement.style.width = '70%';
          console.log('تم إظهار الـ sidebar وتغيير عرض الخريطة');
          
          // إعادة تحديد حجم الخريطة
          setTimeout(() => {
            google.maps.event.trigger(map, 'resize');
            console.log('تم إعادة تحديد حجم الخريطة');
          }, 100);
        }
        
      } catch (error) {
        console.error('خطأ في دالة showSidebar:', error);
        alert('حدث خطأ في عرض معلومات الموقع');
      }
    }

    // أحداث الواجهة
    document.getElementById('close-sidebar').addEventListener('click', function() {
      document.getElementById('sidebar').style.display = 'none';
      document.getElementById('map').style.width = '100%';
      google.maps.event.trigger(map, 'resize');
    });

    document.getElementById('search-button').addEventListener('click', function() {
      performSearch();
    });

    document.getElementById('search-input').addEventListener('keyup', function(event) {
      if (event.keyCode === 13) {
        performSearch();
      }
    });

    // تهيئة الخريطة
    function initMapCallback() {
      console.log('Google Maps API تم تحميلها بنجاح');
      if (typeof google !== 'undefined' && google.maps) {
        initMap();
      } else {
        console.error('Google Maps API غير متاحة');
        setTimeout(initMapCallback, 1000); // إعادة المحاولة بعد ثانية
      }
    }

    // استبدال window.onload
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMapCallback);
    } else {
      initMapCallback();
    }

    // إضافة callback عالمي لـ Google Maps
    window.initMap = initMap;
  </script>
</body>
</html>