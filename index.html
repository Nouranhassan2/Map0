<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø®Ø±ÙŠØ·Ø© Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø­ÙŠ</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDSQwC16g8ZKoyVC2EpixPr0e-7IcPII14&libraries=places&callback=initMap" async defer></script>

  <!-- Firebase SDK v9 -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
      * {
    font-family: 'Tajawal', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif !important;
  }
  
  /* Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø®Ø· ÙÙŠ body */
  body {
    font-family: 'Tajawal', Arial, sans-serif;
    margin: 0;
    padding: 0;
    direction: rtl;
  }
 
    #map {
      height: 100vh;
      width: 100%;
      transition: width 0.3s;
      margin-top: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
    }
    #sidebar {
      height: 100%;
      width: 30%;
      position: fixed;
      left: 0;
      top: 0;
      background-color: #f8f9fa;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
      padding: 20px;
      display: none;
      z-index: 1000;
      transition: transform 0.3s ease;
      overflow-y: auto;
    }
    
    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
    .map-controls {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      background: #ffffff;
      padding: 15px 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid #e0e0e0;
    }
    
    .map-filters {
      display: flex;
      gap: 15px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .filter-btn {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border: 2px solid #dee2e6;
      color: #495057;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      white-space: nowrap;
      min-width: 180px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .filter-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }
    
    .filter-btn:hover::before {
      left: 100%;
    }
    
    .filter-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      border-color: #ea9c57;
      color: #ea9c57;
    }
    
    .filter-btn.active {
      background: linear-gradient(135deg, #ea9c57 0%, #d18a46 100%);
      border-color: #d18a46;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(234, 156, 87, 0.4);
    }
    
    .filter-btn.active:hover {
      background: linear-gradient(135deg, #d18a46 0%, #b8763a 100%);
      color: white;
    }
    
    /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© */
    .filter-btn::after {
      content: '';
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
      margin-left: -4px;
    }
    
    .filter-btn[data-filter="active"]::after {
      background: #22c55e;
      box-shadow: 0 0 6px rgba(34, 197, 94, 0.5);
    }
    
    .filter-btn[data-filter="launching"]::after {
      background: #ea9c57;
      box-shadow: 0 0 6px rgba(234, 156, 87, 0.5);
    }
    
    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      position: absolute;
      top: 100px; /* ØªØ­Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
      right: 20px;
      z-index: 999;
      gap: 10px;
    }
    
    #sidebar h3 {
      margin-top: 0;
      color: #ea9c57;
    }
    #close-sidebar {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: #d9534f;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 5px;
      font-weight: bold;
    }
    #search-input {
      width: 250px;
      height: 40px;
      padding: 8px 12px;
      font-size: 14px;
      background-color: white;
      border: 2px solid #ea9c57;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #search-button {
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      background-color: #ea9c57;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    #search-button:hover {
      background-color: #d97706;
    }
    .whatsapp-share-btn {
      display: inline-block;
      background-color: #25D366;
      color: white;
      padding: 8px 16px;
      font-size: 14px;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    .whatsapp-share-btn:hover {
      background-color: #20b858;
    }
    
    .whatsapp-sidebar-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #25D366;
      color: white;
      padding: 12px 20px;
      font-size: 16px;
      text-decoration: none;
      border-radius: 8px;
      margin-top: 20px;
      transition: background-color 0.3s ease;
      font-weight: bold;
    }
    
    .whatsapp-sidebar-btn:hover {
      background-color: #20b858;
      color: white;
      text-decoration: none;
    }
    
    .whatsapp-icon {
      width: 24px;
      height: 24px;
      margin-right: 10px;
      fill: currentColor;
    }
    
    .info-header {
      font-size: 24px;
      margin-bottom: 15px;
      color: #2c3e50;
    }
    .info-content {
      font-size: 16px;
      padding: 10px 0;
      line-height: 1.6;
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .status-active {
      background-color: #22c55e;
      color: white;
    }
    
    .status-launching {
      background-color: #ea9c57;
      color: white;
    }
    
    .store-stats {
      background-color: #f0f8ff;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border-right: 4px solid #ea9c57;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù†ØµØ§Øª */
    .filter-count {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      padding: 4px 8px;
      font-size: 11px;
      font-weight: bold;
      margin-right: 5px;
      color: #495057;
      border: 1px solid #dee2e6;
    }
    
    .filter-btn.active .filter-count {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border-color: transparent;
    }

    /* Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© */
    .return-to-saudi-btn {
      position: absolute;
      top: 100px;
      left: 20px;
      z-index: 999;
      background: linear-gradient(135deg, #ea9c57 0%, #d18a46 100%);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 4px 15px rgba(234, 156, 87, 0.3);
      transition: all 0.3s ease;
    }

    .return-to-saudi-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(234, 156, 87, 0.4);
      background: linear-gradient(135deg, #d18a46 0%, #b8763a 100%);
    }


    
    @media (max-width: 768px) {
      #sidebar {
        width: 100%;
      }
      #map {
        height: 60vh;
        margin-top: 120px; /* Ù…Ø³Ø§Ø­Ø© Ø£ÙƒØ¨Ø± Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
      }
      .map-controls {
        position: relative;
        top: 0;
        padding: 15px 10px;
        margin-top: 160px;
      }
      
      .map-filters {
        flex-direction: column;
        gap: 10px;
        margin-top: 30px;
      }
      
      .filter-btn {
        min-width: auto;
        font-size: 13px;
        padding: 10px 15px;
        width: 100%;
      }
      
      .controls {
        flex-direction: column;
        position: relative;
        top: 10px;
        right: 10px;
        background: rgba(255,255,255,0.9);
        padding: 10px;
        border-radius: 8px;
        width: fit-content;
      }
      #search-input {
        width: 200px;
        margin-bottom: 10px;
      }

      .return-to-saudi-btn {
        top: 140px;
        left: 10px;
        padding: 10px 15px;
        font-size: 12px;
      }
    }
    .filter-btn {
      background: linear-gradient(135deg, #fefefe 0%, #f7fafc 100%);
      border: 2px solid #e2e8f0;
      color: #4a5568;
      padding: 14px 24px;
      border-radius: 30px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.4s ease;
      white-space: nowrap;
      min-width: 180px;
      text-align: center;
      position: relative;
      box-shadow: 0 3px 12px rgba(0,0,0,0.08);
    }
    
   .filter-btn:hover {
      transform: translateY(-2px) scale(1.02);
    }
    
   .filter-btn[data-filter="all"] {
      background: linear-gradient(135deg, #2b6cb0 0%, #2c5282 100%);
      border-color: #2b6cb0;
      color: white;
    }
    
   .filter-btn[data-filter="all"]:hover {
      background: linear-gradient(135deg, #2c5282 0%, #2a4365 100%);
      box-shadow: 0 8px 30px rgba(43, 108, 176, 0.4);
    }
    
   .filter-btn[data-filter="active"] {
      color: #059669;
      border-color: #059669;
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
    }
    
   .filter-btn[data-filter="active"]:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      border-color: #059669;
      color: white;
      box-shadow: 0 8px 30px rgba(5, 150, 105, 0.4);
    }
    
   .filter-btn[data-filter="launching"] {
      color: #d97706;
      border-color: #d97706;
      background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    }
    
   .filter-btn[data-filter="launching"]:hover {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
      border-color: #d97706;
      color: white;
      box-shadow: 0 8px 30px rgba(217, 119, 6, 0.4);
    }

    /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© */
   .filter-btn::after {
      content: '';
      display: inline-block;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      margin-left: 10px;
      transition: all 0.3s ease;
    }
    
   .filter-btn[data-filter="all"]::after {
      background: radial-gradient(circle, #3b82f6, #1e40af);
      box-shadow: 0 0 12px rgba(59, 130, 246, 0.7);
    }
    
   .filter-btn[data-filter="active"]::after {
      background: radial-gradient(circle, #10b981, #059669);
      box-shadow: 0 0 12px rgba(16, 185, 129, 0.7);
    }
    
   .filter-btn[data-filter="launching"]::after {
      background: radial-gradient(circle, #f59e0b, #d97706);
      box-shadow: 0 0 12px rgba(245, 158, 11, 0.7);
    }
  </style>
</head>
<body>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
  <div class="map-controls">
    <div class="map-filters">
      <button class="filter-btn active" data-filter="all">
        <span class="filter-count" id="count-all">40</span>
        Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØµØ§Øª
      </button>
      <button class="filter-btn" data-filter="active">
        Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§
      </button>
      <button class="filter-btn" data-filter="launching">
        Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹
      </button>
    </div>
  </div>

  <!-- Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
  <div id="map"></div>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
  <div id="sidebar">
    <button id="close-sidebar">âœ•</button>
    <h3 id="location-name" class="info-header"></h3>
    <div id="status-badge" class="status-badge"></div>
    
    <div class="info-content">
      <div class="store-stats" id="stats-container">
        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
      </div>
      
      <p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> <span id="location-details"></span></p>
      <a id="location-link" href="#" target="_blank" style="color: #ea9c57; font-weight: bold;">Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ù†ØµØ©</a>
      <br><br>
      <img id="location-image" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹" style="width:100%; height:auto; border-radius: 8px;">
      
      <!-- Ø²Ø± Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨ -->
      <a id="whatsapp-share-sidebar" href="#" target="_blank" class="whatsapp-sidebar-btn">
        <svg class="whatsapp-icon" viewBox="0 0 24 24">
          <path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.582 2.128 2.182-.573c.978.58 1.911.928 3.145.929 3.178 0 5.767-2.587 5.768-5.766.001-3.187-2.575-5.77-5.764-5.771zm3.392 8.244c-.144.405-.837.774-1.17.824-.299.045-.677.063-1.092-.069-.252-.08-.575-.187-.988-.365-1.739-.751-2.874-2.502-2.961-2.617-.087-.116-.708-.94-.708-1.793s.448-1.273.607-1.446c.159-.173.346-.217.462-.217l.332.006c.106.005.249-.04.39.298.144.347.491 1.2.534 1.287.043.087.072.188.014.304-.058.116-.087.188-.173.289l-.26.304c-.087.086-.177.18-.076.354.101.174.449.741.964 1.201.662.591 1.221.774 1.394.86s.274.072.376-.043c.101-.116.433-.506.549-.68.116-.173.231-.145.39-.087s1.011.477 1.184.564.289.13.332.202c.045.072.045.419-.1.824z"/>
        </svg>
        Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
      </a>
    </div>
  </div>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAFCAV-C1B9gH7-F64MuZpdlcoGMhZK-_Y",
      authDomain: "matajer-ebb39.firebaseapp.com",
      projectId: "matajer-ebb39",
      storageBucket: "matajer-ebb39.firebasestorage.app",
      messagingSenderId: "88280903010",
      appId: "1:88280903010:web:6a01c7ef50ef9b1c29903b",
      measurementId: "G-2E7NR6FLHX"
    };

    // ØªÙ‡ÙŠØ¦Ø© Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let map, highlightCircle;
    let markers = [];
    let allLocations = []; // Ù†Ø³Ø®Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹
    let currentFilter = 'all'; // Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
    let firebaseData = {}; // ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Firebase

    const locations = [
      // Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø·Ù„Ù‚Ø© (Active) - Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ØªØªØ­Ø¯Ø« Ù…Ù† Firebase Ø£Ùˆ ØªØ¨Ù‚Ù‰ 0
      { lat: 20.6098, lng: 41.7462, name: 'Ø§Ù„Ù‚Ù†ÙØ°Ø©', link: 'https://qn1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.9758, lng: 43.5711, name: 'Ø¹ÙŠÙˆÙ† Ø§Ù„Ø¬ÙˆØ§Ø¡', link: 'https://uj1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.8614, lng: 43.5711, name: 'Ø¹Ù‚Ù„Ø© Ø§Ù„ØµÙ‚ÙˆØ±', link: 'https://asq1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 17.1865, lng: 42.5923, name: 'ØµØ¨ÙŠØ§', link: 'https://sby1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.8872, lng: 44.0256, name: 'Ø§Ù„Ù…Ø°Ù†Ø¨', link: 'https://mzn1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 20.0129, lng: 41.4677, name: 'Ø¨Ù„Ø¬Ø±Ø´ÙŠ', link: 'https://blj1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 26.8906, lng: 44.6497, name: 'Ø§Ù„Ø²Ù„ÙÙŠ', link: 'https://zl1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.2745, lng: 45.3825, name: 'Ø§Ù„ØºØ§Ø·', link: 'https://gt1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.7277, lng: 45.1645, name: 'Ø±ÙŠØ§Ø¶ Ø§Ù„Ø®Ø¨Ø±Ø§Ø¡', link: 'https://rkh1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 20.2196, lng: 40.3367, name: 'Ø§Ù„Ù„ÙŠØ«', link: 'https://lt1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 27.5214, lng: 41.6900, name: 'Ø­Ø§Ø¦Ù„', link: 'https://ha1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.9084, lng: 45.3596, name: 'Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©', link: 'https://rydh7.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.7605, lng: 45.3943, name: 'ØªÙ…ÙŠØ±', link: 'https://rydh5.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.2951, lng: 46.4067, name: 'Ø´Ù‚Ø±Ø§Ø¡', link: 'https://rydh8.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.5951, lng: 45.6338, name: 'Ø³Ø¯ÙŠØ±', link: 'https://rydh6.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      
      // Ø¬Ø¯Ø©
      { lat: 21.5454, lng: 39.2049, name: 'Ø¬Ø¯Ø© / Ø§Ù„Ø¨Ø´Ø§Ø¦Ø± - Ø§Ù„Ø­Ù…Ø¯Ø§Ù†ÙŠØ©', link: 'https://jed4.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 21.5433, lng: 39.1728, name: 'Ø¬Ø¯Ø© / Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø·ÙŠØ¨Ø© - Ø£Ø¨Ø­Ø±', link: 'https://jed6.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 21.6011, lng: 39.1802, name: 'Ø¬Ø¯Ø© / Ø§Ù„Ù†Ø³ÙŠÙ… - Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©', link: 'https://jed11.matajeralhai.com', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 21.2854, lng: 39.2376, name: 'Ø¬Ø¯Ø© / Ø§Ù„Ø³Ù†Ø§Ø¨Ù„ - Ø§Ù„Ø£Ø¬Ø§ÙˆÙŠØ¯', link: 'http://jed1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: 'https://jed1.matajeralhai.com/Images/Photos/63f719b49e404dbb9a7217ded02fef23.webp' },
      { lat: 21.5027, lng: 39.2433, name: 'Ø¬Ø¯Ø© / Ø§Ù„ÙØ¶ÙŠÙ„Ø© - Ø§Ù„Ù‚Ø±ÙŠÙ†ÙŠØ© - Ø§Ù„Ø®Ù…Ø±Ø©', link: 'https://jed5.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 21.5752, lng: 39.2125, name: 'Ø¬Ø¯Ø© / Ø§Ù„Ø³Ø§Ù…Ø±', link: 'https://jed2.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 21.6319, lng: 39.1225, name: 'Ø¬Ø¯Ø© / Ø§Ù„Ù†Ø¹ÙŠÙ… - Ø§Ù„Ù…Ø­Ù…Ø¯ÙŠØ© - Ø§Ù„Ø¨Ø³Ø§ØªÙŠÙ† - Ø§Ù„Ù…Ø±Ø¬Ø§Ù†', link: 'https://jed10.matajeralhai.com', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      
      // Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©
      { lat: 24.4620, lng: 39.6120, name: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© / Ø§Ù„Ø¯ÙØ§Ø¹', link: 'https://md1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 24.4740, lng: 39.6100, name: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© / Ø§Ù„Ø¹Ø²ÙŠØ²ÙŠØ©', link: 'https://md2.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 24.4740, lng: 39.6100, name: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© / Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠØ©', link: 'https://md3.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 24.4680, lng: 39.6080, name: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© / Ø§Ù„Ø³Ù„Ø§Ù… - Ø§Ù„Ø¬Ù…Ø§ÙˆØ§Øª', link: 'https://md4.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      
      // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø¯Ù†
      { lat: 16.8894, lng: 42.5824, name: 'Ø¬ÙŠØ²Ø§Ù†', link: 'https://jzn1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 20.0129, lng: 41.4677, name: 'Ø§Ù„Ø¨Ø§Ø­Ø©', link: 'https://ba1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      { lat: 18.2175, lng: 42.5058, name: 'Ø£Ø¨Ù‡Ø§', link: 'https://ab1.matajeralhai.com/', status: 'active', storesCount: 0, offersCount: 0, image: '' },
      
      // Ø§Ù„Ù…Ù†ØµØ§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ² (Launching)
      { lat: 26.1496, lng: 43.6397, name: 'Ø§Ù„Ø¨ÙƒÙŠØ±ÙŠØ©', link: 'https://bkr1.matajeralhai.com/', status: 'launching', launchProgress: 67, storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.0243, lng: 45.3072, name: 'Ø¬Ù„Ø§Ø¬Ù„', link: 'https://jl1.matajeralhai.com/', status: 'launching', launchProgress: 54, storesCount: 0, offersCount: 0, image: '' },
      { lat: 17.1282, lng: 42.4447, name: 'Ø¨ÙŠØ´', link: 'https://bi1.matajeralhai.com/', status: 'launching', launchProgress: 43, storesCount: 0, offersCount: 0, image: '' },
      { lat: 24.4871, lng: 39.5679, name: 'Ø§Ù„Ø­Ù†Ø§ÙƒÙŠØ©', link: 'https://hnk1.matajeralhai.com/', status: 'launching', launchProgress: 58, storesCount: 0, offersCount: 0, image: '' },
      { lat: 25.9178, lng: 43.7036, name: 'Ø§Ù„Ø¨Ø¯Ø§Ø¦Ø¹', link: 'https://bda1.matajeralhai.com/', status: 'launching', launchProgress: 39, storesCount: 0, offersCount: 0, image: '' },
      { lat: 20.1938, lng: 41.4710, name: 'Ø§Ù„Ù…Ù†Ø¯Ù‚', link: 'https://mdq1.matajeralhai.com/', status: 'launching', launchProgress: 48, storesCount: 0, offersCount: 0, image: '' },
      { lat: 24.7000, lng: 40.5000, name: 'Ø§Ù„Ù‚ÙˆØ§Ø±ÙŠØ±', link: 'https://qw1.matajeralhai.com/', status: 'launching', launchProgress: 31, storesCount: 0, offersCount: 0, image: '' },
      { lat: 20.8000, lng: 41.3000, name: 'Ø¨ÙŠØ¯Ø©', link: 'https://bid1.matajeralhai.com/', status: 'launching', launchProgress: 42, storesCount: 0, offersCount: 0, image: '' },
      { lat: 27.0500, lng: 43.8000, name: 'Ù‚ÙŠØ§', link: 'https://qy1.matajeralhai.com/', status: 'launching', launchProgress: 36, storesCount: 0, offersCount: 0, image: '' },
      { lat: 26.9000, lng: 43.2000, name: 'Ù‚Ø±Ù‰', link: 'https://ko1.matajeralhai.com/', status: 'launching', launchProgress: 29, storesCount: 0, offersCount: 0, image: '' },
      { lat: 24.8000, lng: 40.7000, name: 'Ø§Ù„Ø£Ø·Ø§ÙˆÙ„Ø©', link: 'https://at1.matajeralhai.com/', status: 'launching', launchProgress: 52, storesCount: 0, offersCount: 0, image: '' }
    ];

    // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    allLocations = [...locations];

    // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
    async function loadFirebaseData() {
      try {
        console.log("ğŸ”¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase...");
        
        const snapshot = await db.collection('platforms').get();
        
        if (!snapshot.empty) {
          snapshot.forEach((doc) => {
            const data = doc.data();
            const platformId = doc.id;
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙƒØ§Ø´
            firebaseData[platformId] = {
              storesCount: data.storesCount || 0,
              offersCount: data.offersCount || 0,
              lastUpdated: data.lastUpdated
            };
          });
          
          console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase:", firebaseData);
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹
          updateLocationsWithFirebaseData();
          
          // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¬Ø§Ù‡Ø²Ø©
          if (map) {
            redrawMarkers();
          }
        } else {
          console.log("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase");
        }
        
      } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase:", error);
      }
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Firebase
    function updateLocationsWithFirebaseData() {
      // Ø±Ø¨Ø· Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ§Øª Ø¨Ù€ IDs ÙÙŠ Firebase
      const platformMapping = {
        'Ø§Ù„Ù‚Ù†ÙØ°Ø©': 'qnfudhah',
        'Ø¹ÙŠÙˆÙ† Ø§Ù„Ø¬ÙˆØ§Ø¡': 'uyun_aljawa',
        'Ø¹Ù‚Ù„Ø© Ø§Ù„ØµÙ‚ÙˆØ±': 'aqlat_alsuqur',
        'ØµØ¨ÙŠØ§': 'sabya',
        'Ø§Ù„Ù…Ø°Ù†Ø¨': 'almudhannab',
        'Ø¨Ù„Ø¬Ø±Ø´ÙŠ': 'baljurashi',
        'Ø§Ù„Ø²Ù„ÙÙŠ': 'alzulfi',
        'Ø§Ù„ØºØ§Ø·': 'alghat',
        'Ø±ÙŠØ§Ø¶ Ø§Ù„Ø®Ø¨Ø±Ø§Ø¡': 'riyadh_alkhabra',
        'Ø§Ù„Ù„ÙŠØ«': 'allayth',
        'Ø­Ø§Ø¦Ù„': 'hail',
        'Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©': 'almajmaah',
        'ØªÙ…ÙŠØ±': 'tamir',
        'Ø´Ù‚Ø±Ø§Ø¡': 'shaqra',
        'Ø³Ø¯ÙŠØ±': 'sudair',
        'Ø¬Ø¯Ø© / Ø§Ù„Ø¨Ø´Ø§Ø¦Ø± - Ø§Ù„Ø­Ù…Ø¯Ø§Ù†ÙŠØ©': 'jeddah_bashaer',
        'Ø¬Ø¯Ø© / Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø·ÙŠØ¨Ø© - Ø£Ø¨Ø­Ø±': 'jeddah_riyadh',
        'Ø¬Ø¯Ø© / Ø§Ù„Ù†Ø³ÙŠÙ… - Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©': 'jeddah_naseem',
        'Ø¬Ø¯Ø© / Ø§Ù„Ø³Ù†Ø§Ø¨Ù„ - Ø§Ù„Ø£Ø¬Ø§ÙˆÙŠØ¯': 'jeddah_sanabel',
        'Ø¬Ø¯Ø© / Ø§Ù„ÙØ¶ÙŠÙ„Ø© - Ø§Ù„Ù‚Ø±ÙŠÙ†ÙŠØ© - Ø§Ù„Ø®Ù…Ø±Ø©': 'jeddah_fadila',
        'Ø¬Ø¯Ø© / Ø§Ù„Ø³Ø§Ù…Ø±': 'jeddah_samer',
        'Ø¬Ø¯Ø© / Ø§Ù„Ù†Ø¹ÙŠÙ… - Ø§Ù„Ù…Ø­Ù…Ø¯ÙŠØ© - Ø§Ù„Ø¨Ø³Ø§ØªÙŠÙ† - Ø§Ù„Ù…Ø±Ø¬Ø§Ù†': 'jeddah_naeem',
        'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© / Ø§Ù„Ø¯ÙØ§Ø¹': 'madinah_difa',
        'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© / Ø§Ù„Ø¹Ø²ÙŠØ²ÙŠØ©': 'madinah_aziziya',
        'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© / Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠØ©': 'madinah_khalidiya',
        'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© / Ø§Ù„Ø³Ù„Ø§Ù… - Ø§Ù„Ø¬Ù…Ø§ÙˆØ§Øª': 'madinah_salam',
        'Ø¬ÙŠØ²Ø§Ù†': 'jazan',
        'Ø§Ù„Ø¨Ø§Ø­Ø©': 'albaha',
        'Ø£Ø¨Ù‡Ø§': 'abha'
      };

      allLocations.forEach(location => {
        const platformId = platformMapping[location.name];
        
        if (platformId && firebaseData[platformId]) {
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
          location.storesCount = firebaseData[platformId].storesCount;
          location.offersCount = firebaseData[platformId].offersCount;
          location.lastUpdated = firebaseData[platformId].lastUpdated;
          location.dataSource = 'firebase';
          
          console.log(`ğŸ“Š ØªÙ… ØªØ­Ø¯ÙŠØ« ${location.name} Ù…Ù† Firebase: ${location.storesCount} Ù…ØªØ¬Ø±ØŒ ${location.offersCount} Ø¹Ø±Ø¶`);
        } else {
          // Ø§Ù„Ù…Ù†ØµØ§Øª ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Firebase = Ø£Ø±Ù‚Ø§Ù… 0
          if (location.status === 'active') {
            location.storesCount = 0;
            location.offersCount = 0;
            location.dataSource = 'default';
            location.lastUpdated = null;
            
            console.log(`âš ï¸ ${location.name} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Firebase - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø±Ù‚Ø§Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: 0`);
          } else if (location.status === 'launching') {
            // Ø§Ù„Ù…Ù†ØµØ§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ ØªØ¨Ù‚Ù‰ 0 Ø£ØµÙ„Ø§Ù‹
            location.storesCount = 0;
            location.offersCount = 0;
            location.dataSource = 'launching';
            location.lastUpdated = null;
          }
        }
      });
    }

    // Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
    function redrawMarkers() {
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      markers.forEach(marker => marker.setMap(null));
      markers = [];
      
      // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
      filterPlatforms(currentFilter);
    }

    // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Firebase
    function setupFirebaseListener() {
      db.collection('platforms').onSnapshot((snapshot) => {
        console.log("ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Firebase...");
        
        snapshot.docChanges().forEach((change) => {
          const platformId = change.doc.id;
          const data = change.doc.data();
          
          if (change.type === 'added' || change.type === 'modified') {
            firebaseData[platformId] = {
              storesCount: data.storesCount || 0,
              offersCount: data.offersCount || 0,
              lastUpdated: data.lastUpdated
            };
            
            console.log(`ğŸ“ˆ ØªÙ… ØªØ­Ø¯ÙŠØ« ${platformId}: ${data.storesCount} Ù…ØªØ¬Ø±ØŒ ${data.offersCount} Ø¹Ø±Ø¶`);
          }
          
          if (change.type === 'removed') {
            delete firebaseData[platformId];
            console.log(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù ${platformId}`);
          }
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±Ø³Ù…
        updateLocationsWithFirebaseData();
        if (map) {
          redrawMarkers();
        }
      }, (error) => {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Firebase:", error);
      });
    }

    function getStatusInfo(status, location) {
      switch(status) {
        case 'active':
          return {
            text: 'Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù†',
            class: 'status-active',
            description: 'ÙŠÙ…ÙƒÙ†Ùƒ Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ù†ØµØ© ÙˆØ§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…ØªØ§Ø­Ø©'
          };
        case 'launching':
          return {
            text: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚',
            class: 'status-launching',
            description: `Ø§Ù„ØªÙ‚Ø¯Ù…: ${location.launchProgress || 0}% - Ø³ÙŠÙƒÙˆÙ† Ù…ØªØ§Ø­Ø§Ù‹ Ù‚Ø±ÙŠØ¨Ø§Ù‹`
          };
        default:
          return {
            text: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
            class: 'status-launching',
            description: 'Ø§Ù„Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'
          };
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    function updateFilterCounts() {
      const countAll = document.getElementById('count-all');
      if (countAll) {
        countAll.textContent = allLocations.length;
      }
    }

    // ØªØµÙÙŠØ© Ø§Ù„Ù…Ù†ØµØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    function filterPlatforms(filter) {
      
      // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
      markers.forEach(marker => {
        marker.setMap(null);
      });
      
      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¹Ø±Ø¶Ù‡Ø§
      let locationsToShow = [];
      if (filter === 'all') {
        locationsToShow = allLocations;
      } else {
        locationsToShow = allLocations.filter(location => location.status === filter);
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù„Ø§Ù…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
      markers = [];
      locationsToShow.forEach((location, index) => {
        const marker = createMarker(location);
        markers.push(marker);
      });
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø·
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
      
      currentFilter = filter;
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù„Ø§Ù…Ø© ÙˆØ§Ø­Ø¯Ø©
    function createMarker(location) {
      const status = location.status || 'launching';
      const icon = pinIcons[status] || pinIcons.launching;
      
      const marker = new google.maps.Marker({
        position: { lat: location.lat, lng: location.lng },
        map: map,
        icon: icon,
        title: location.name,
        clickable: true,
        optimized: false
      });

      marker.addListener('click', function() {
        showSidebar(location);
      });

      return marker;
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
    function returnToSaudiArabia() {
      const saudiCenter = { lat: 23.8859, lng: 45.0792 };
      map.setCenter(saudiCenter);
      map.setZoom(6);
    }

    function initMap() {
      
      // ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù€ pins
      window.pinIcons = {
        active: {
          url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
            <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="greenGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#34d399;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#22c55e;stop-opacity:1" />
                </linearGradient>
              </defs>
              <ellipse cx="50" cy="115" rx="15" ry="5" fill="#00000020"/>
              <path d="M50 10 C30 10, 15 25, 15 45 C15 65, 50 100, 50 100 S85 65, 85 45 C85 25, 70 10, 50 10 Z" 
                    fill="url(#greenGradient)" stroke="#16a34a" stroke-width="2"/>
              <circle cx="50" cy="45" r="25" fill="#f8fbfd" stroke="#22c55e" stroke-width="2"/>
              <g transform="translate(50, 45)">
                <rect x="-12" y="-8" width="24" height="16" fill="#22c55e" rx="2"/>
                <rect x="-3" y="-2" width="6" height="8" fill="#f8fbfd" rx="1"/>
                <rect x="-10" y="-6" width="4" height="4" fill="#f8fbfd" rx="0.5"/>
                <rect x="6" y="-6" width="4" height="4" fill="#f8fbfd" rx="0.5"/>
                <polygon points="-14,-8 0,-15 14,-8" fill="#16a34a"/>
                <circle cx="2" cy="2" r="0.8" fill="#22c55e"/>
              </g>
              <circle cx="50" cy="45" r="3" fill="#7ebfe9"/>
              <ellipse cx="42" cy="35" rx="8" ry="12" fill="#ffffff40"/>
            </svg>
          `),
          scaledSize: new google.maps.Size(50, 60),
          anchor: new google.maps.Point(25, 60)
        },
        launching: {
          url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
            <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="orangeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#f4a568;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#ea9c57;stop-opacity:1" />
                </linearGradient>
              </defs>
              <ellipse cx="50" cy="115" rx="15" ry="5" fill="#00000020"/>
              <path d="M50 10 C30 10, 15 25, 15 45 C15 65, 50 100, 50 100 S85 65, 85 45 C85 25, 70 10, 50 10 Z" 
                    fill="url(#orangeGradient)" stroke="#d18a46" stroke-width="2"/>
              <circle cx="50" cy="45" r="25" fill="#f8fbfd" stroke="#ea9c57" stroke-width="2"/>
              <g transform="translate(50, 45)">
                <rect x="-12" y="-8" width="24" height="16" fill="#ea9c57" rx="2"/>
                <rect x="-3" y="-2" width="6" height="8" fill="#f8fbfd" rx="1"/>
                <rect x="-10" y="-6" width="4" height="4" fill="#f8fbfd" rx="0.5"/>
                <rect x="6" y="-6" width="4" height="4" fill="#f8fbfd" rx="0.5"/>
                <polygon points="-14,-8 0,-15 14,-8" fill="#d18a46"/>
                <circle cx="2" cy="2" r="0.8" fill="#ea9c57"/>
              </g>
              <circle cx="50" cy="45" r="3" fill="#7ebfe9"/>
              <ellipse cx="42" cy="35" rx="8" ry="12" fill="#ffffff40"/>
            </svg>
          `),
          scaledSize: new google.maps.Size(50, 60),
          anchor: new google.maps.Point(25, 60)
        }
      };

      // Ù…Ø±ÙƒØ² Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© ÙƒÙ†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
      const mapCenter = { lat: 24.0, lng: 45.0 };
      
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 6,
        center: mapCenter,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        minZoom: 1,
        maxZoom: 22,
        styles: [
          {
            featureType: "poi",
            elementType: "labels",
            stylers: [{ visibility: "off" }]
          }
        ]
      });

      // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      loadFirebaseData();
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
      setupFirebaseListener();

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
      updateFilterCounts();

      // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
      allLocations.forEach((location, index) => {
        const marker = createMarker(location);
        markers.push(marker);
      });

      // Ø¥Ø¶Ø§ÙØ© event listeners Ù„Ù„Ø£Ø²Ø±Ø§Ø±
      document.querySelectorAll('.filter-btn').forEach(button => {
        button.addEventListener('click', function() {
          const filter = this.getAttribute('data-filter');
          filterPlatforms(filter);
        });
      });
    }

    function showSidebar(location) {
      
      try {
        const statusInfo = getStatusInfo(location.status, location);
        
        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹
        const locationNameElement = document.getElementById('location-name');
        if (locationNameElement) {
          locationNameElement.textContent = location.name;
        }
        
        const locationDetailsElement = document.getElementById('location-details');
        if (locationDetailsElement) {
          locationDetailsElement.textContent = location.name;
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©
        const statusBadge = document.getElementById('status-badge');
        if (statusBadge) {
          statusBadge.textContent = statusInfo.text;
          statusBadge.className = 'status-badge ' + statusInfo.class;
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        const statsContainer = document.getElementById('stats-container');
        if (statsContainer) {
          if (location.status === 'active') {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù…Ù† Firebase Ø£Ùˆ 0 Ù„Ù„Ù…Ù†ØµØ§Øª ØºÙŠØ± Ø§Ù„Ù…Ø¯Ø®Ù„Ø©
            const storesCount = location.storesCount || 0;
            const offersCount = location.offersCount || 0;
            const lastUpdated = location.lastUpdated;
            const dataSource = location.dataSource || 'default';
            
            let updateInfo = '';
            let dataSourceInfo = '';
            
            // if (dataSource === 'firebase' && lastUpdated) {
            //   const updateDate = new Date(lastUpdated.seconds * 1000);
            //   updateInfo = `<div class="stat-item">
            //     <span>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</span>
            //     <strong style="color: #666; font-size: 12px;">${updateDate.toLocaleDateString('ar-SA')}</strong>
            //   </div>`;
            //   dataSourceInfo = `<div style="margin-top: 10px; padding: 8px; background: rgba(34, 197, 94, 0.1); border-radius: 6px; font-size: 12px; color: #059669;">
            //     <i class="fas fa-database"></i> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            //   </div>`;
            // } else if (dataSource === 'default') {
            //   dataSourceInfo = `<div style="margin-top: 10px; padding: 8px; background: rgba(255, 193, 7, 0.1); border-radius: 6px; font-size: 12px; color: #856404;">
            //     <i class="fas fa-exclamation-triangle"></i> Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø¹Ø¯
            //   </div>`;
            // }
            
            statsContainer.innerHTML = `
              <h4 style="margin: 0 0 10px 0; color: #2c3e50;">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†ØµØ©</h4>
              <div class="stat-item">
                <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ§Ø¬Ø±:</span>
                <strong style="color: ${storesCount > 0 ? '#22c55e' : '#999'};">${storesCount} Ù…ØªØ¬Ø±</strong>
              </div>
              <div class="stat-item">
                <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø±ÙˆØ¶:</span>
                <strong style="color: ${offersCount > 0 ? '#ea9c57' : '#999'};">${offersCount} Ø¹Ø±Ø¶</strong>
              </div>
              <div class="stat-item">
                <span>Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                <strong style="color: #22c55e;">Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù† âœ“</strong>
              </div>
              ${updateInfo}
              ${dataSourceInfo}
            `;
          } else if (location.status === 'launching') {
            statsContainer.innerHTML = `
              <h4 style="margin: 0 0 10px 0; color: #2c3e50;">ğŸš§ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚</h4>
              <div class="stat-item">
                <span>Ø§Ù„ØªÙ‚Ø¯Ù…:</span>
                <strong>${location.launchProgress || 0}%</strong>
              </div>
              <div class="stat-item">
                <span>Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                <strong style="color: #ea9c57;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡Ø§</strong>
              </div>
              <div class="stat-item">
                <span>Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:</span>
                <strong style="color: #666;">Ù‚Ø±ÙŠØ¨Ø§Ù‹</strong>
              </div>
              <p style="margin: 10px 0; color: #666; font-size: 14px;">
                Ù†Ø¹Ù…Ù„ Ø¨Ø¬Ø¯ Ù„Ø¥Ø·Ù„Ø§Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†ØµØ© Ù‚Ø±ÙŠØ¨Ø§Ù‹. Ø³Ù†Ø¨Ù„ØºÙƒ ÙÙˆØ± ØªÙˆÙØ±Ù‡Ø§!
              </p>
            `;
          }
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø§Ø¨Ø· Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø£Ùˆ Ø¥Ø®ÙØ§Ø¤Ù‡
        const locationLink = document.getElementById('location-link');
        if (locationLink) {
          if (location.link && location.status === 'active') {
            locationLink.href = location.link;
            locationLink.style.display = 'inline-block';
            locationLink.textContent = 'Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø¢Ù†';
          } else {
            locationLink.style.display = 'none';
          }
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙˆØ±Ø©
        const locationImage = document.getElementById('location-image');
        if (locationImage) {
          if (location.image) {
            locationImage.src = location.image;
            locationImage.style.display = 'block';
          } else {
            locationImage.style.display = 'none';
          }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨
        let shareMessage = `ğŸª Ø§ÙƒØªØ´Ù Ù…ÙˆÙ‚Ø¹: ${location.name}\n`;
        shareMessage += `ğŸ“ Ø§Ù„Ø­Ø§Ù„Ø©: ${statusInfo.text}\n`;
        
        if (location.status === 'active' && location.link) {
          shareMessage += `ğŸ”— Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ù†ØµØ©: ${location.link}\n`;
          shareMessage += `ğŸ¬ Ø§Ù„Ù…ØªØ§Ø¬Ø±: ${location.storesCount || 0} Ù…ØªØ¬Ø±\n`;
          shareMessage += `ğŸ¯ Ø§Ù„Ø¹Ø±ÙˆØ¶: ${location.offersCount || 0} Ø¹Ø±Ø¶\n`;
        } else if (location.status === 'launching') {
          shareMessage += `â³ Ø§Ù„ØªÙ‚Ø¯Ù…: ${location.launchProgress || 0}%\n`;
        }
        
        shareMessage += `\nğŸ“± ØªØ§Ø¨Ø¹ Ø¬Ù…ÙŠØ¹ Ù…Ù†ØµØ§Øª Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø­ÙŠ Ø¹Ù„Ù‰ Ø®Ø±ÙŠØ·ØªÙ†Ø§ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©!`;
        
        const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(shareMessage)}`;
        
        // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
        const whatsappButton = document.getElementById('whatsapp-share-sidebar');
        if (whatsappButton) {
          whatsappButton.href = whatsappUrl;
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
        const sidebar = document.getElementById('sidebar');
        const mapElement = document.getElementById('map');
        
        if (sidebar && mapElement) {
          sidebar.style.display = 'block';
          mapElement.style.width = '70%';
          
          // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ¯ Ø­Ø¬Ù… Ø§Ù„Ø®Ø±ÙŠØ·Ø©
          setTimeout(() => {
            google.maps.event.trigger(map, 'resize');
          }, 100);
        }
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹:', error);
      }
    }

    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    document.getElementById('close-sidebar').addEventListener('click', function() {
      document.getElementById('sidebar').style.display = 'none';
      document.getElementById('map').style.width = '100%';
      google.maps.event.trigger(map, 'resize');
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    function initMapCallback() {
      if (typeof google !== 'undefined' && google.maps) {
        initMap();
      } else {
        setTimeout(initMapCallback, 1000);
      }
    }

    // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ window.onload
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMapCallback);
    } else {
      initMapCallback();
    }

    // Ø¥Ø¶Ø§ÙØ© callback Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù€ Google Maps
    window.initMap = initMap;
  </script>
</body>
</html>